"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[670],{28670:function(e,s,n){n.r(s),n.d(s,{default:function(){return K}});var a=n(74165),t=n(15861),i=n(29439),r=n(72791),c=n(28782),o=n(35796),d=n(60732),l=n(47105),u=n(35337),m=n(78687),f=n(72053),g=n(81694),h=n.n(g),v=function(e){if(e){return Date.now()-(Date.parse(e)+108e5)<12e5}return!1},x=n(87138),j=n(50798),p=n(48789),_=n(65457),Z=n(14553),N=n(80184),M=x.Z.confirm,D=r.memo((function(e){var s=e.name,n=e.id,g=e.src,D=e.hasNewMessages,w=e.newMessagesCount,y=e.date,b=e.activityDate,k=e.selectedId,E=(0,l.T)(),I=(0,m.v9)(f.qf),C=(0,m.v9)(f.S3),S=(0,r.useState)(!1),F=(0,i.Z)(S,2),T=F[0],L=F[1],A=function(){var e=(0,t.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x.Z.error({title:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433"});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=(0,t.Z)((0,a.Z)().mark((function e(){var s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.G.getNewMessages();case 2:s=e.sent,E(Z.E4.setNumberOfNewMessages(s));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=(0,t.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E((0,u.ti)(n,I,C)).then((function(){return E((0,u.R$)())})).then((function(){return O()})),E(Z.E4.setDialogID(n));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,N.jsxs)("div",{onMouseEnter:function(){return L(!0)},onMouseLeave:function(){return L(!1)},onClick:P,className:h()("dialog__item",{"dialog__item--online":v(b),"dialog__item--selected":n===k}),children:[(0,N.jsx)("div",{className:"dialog__item-avatar",children:(0,N.jsx)(_.fh,{avatarUrl:g,name:s,height:"40px"})}),(0,N.jsxs)("div",{className:"dialog__item-info",children:[(0,N.jsxs)("div",{className:"dialog__item-info-top",children:[(0,N.jsx)("b",{children:s}),!T&&(0,N.jsx)("span",{children:(0,N.jsx)(c.F,{date:y,showFullDate:!1})}),T&&(0,N.jsx)(j.Z,{mouseLeaveDelay:.05,mouseEnterDelay:.6,title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433",children:(0,N.jsx)(d.Z,{onClick:function(e){M({title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433?",icon:(0,N.jsx)(o.Z,{}),content:"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0431\u0443\u0434\u0435\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e",okText:"\u0414\u0430",okButtonProps:{ghost:!0},okType:"danger",cancelText:"\u041d\u0435\u0442",onOk:function(){A()}}),e.stopPropagation()}})})]}),(0,N.jsxs)("div",{className:"dialog__item-info-bottom",children:[!v(b)&&(0,N.jsx)("p",{children:(0,N.jsx)(c.C,{date:b})}),v(b)&&(0,N.jsx)("p",{children:"\u0412 \u0441\u0435\u0442\u0438"}),D&&(0,N.jsx)("div",{className:"dialog__item-info-bottom-count",children:w})]})]})]})})),w=r.memo((function(e){var s=e.dialogs,n=e.id;if(s.length&&n){var a=s.find((function(e){return e.id===n})),t=v(a.lastUserActivityDate);return(0,N.jsxs)("div",{className:"chat__dialog-header-center",children:[(0,N.jsx)("b",{className:"chat__dialog-header-name",children:null===a||void 0===a?void 0:a.userName}),(0,N.jsx)("div",{className:"chat__dialog-header-status",children:(0,N.jsx)("span",{className:h()("status",{"status--online":t}),children:t?(0,N.jsx)("span",{children:"Online"}):(0,N.jsx)("span",{children:"Offline"})})})]})}return(0,N.jsx)("div",{})})),y=n(69421),b=function(e){var s=e.dialogs,n=e.filter,a=e.selectedId,t=s.filter((function(e){return-1!==e.userName.toLowerCase().indexOf(n)}));return 0===t.length?(0,N.jsx)(y.Z,{image:y.Z.PRESENTED_IMAGE_SIMPLE,description:"\u041d\u0435\u0442 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432"}):(0,N.jsx)(N.Fragment,{children:t.map((function(e){return(0,N.jsx)(D,{name:e.userName,id:e.id,src:e.photos.small,hasNewMessages:e.hasNewMessages,newMessagesCount:e.newMessagesCount,date:e.lastDialogActivityDate,activityDate:e.lastUserActivityDate,selectedId:a},e.id)}))})},k=n(77819),E=n(94924),I=r.memo((function(e){var s,n=e.dialogs,a=e.id,t=e.setMessageSending,i=e.isMessageSending,c=(0,m.v9)(k.FD),o=(0,m.v9)(E.ar),d=(0,m.v9)(f.xm),l=(0,r.useRef)(null),u=null===(s=n.find((function(e){return e.id===a})))||void 0===s?void 0:s.photos.small;return(0,r.useEffect)((function(){var e;null===(e=l.current)||void 0===e||e.scrollIntoView({behavior:i?"smooth":"auto",block:"end",inline:"nearest"})})),(0,r.useEffect)((function(){t(!1)}),[a]),0===d.length?(0,N.jsx)(y.Z,{className:"chat__dialog-messages-empty",description:"\u041d\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439"}):(0,N.jsxs)(N.Fragment,{children:[d.map((function(e){return(0,N.jsx)(O,{messageId:e.id,message:e.body,avatar:e.senderId===c?o:u,date:e.addedAt,isMe:e.senderId===c,viewed:e.senderId!==c||e.viewed},e.id)})),(0,N.jsx)("div",{ref:l})]})})),C=n(91515),S=n(82622);var F=n.p+"static/media/readed.da3c99324b4eb3958865b24076453ba3.svg";var T=n.p+"static/media/noreaded.a7c0ab31b14324a6272d3bb9feae835b.svg",L=n(20713),A=x.Z.confirm,O=r.memo((function(e){var s=e.message,n=e.messageId,d=e.avatar,g=e.date,v=e.isMe,x=e.viewed,j=(0,r.useState)(!1),p=(0,i.Z)(j,2),_=p[0],Z=p[1],M=(0,r.useState)(!1),D=(0,i.Z)(M,2),w=D[0],y=D[1],b=(0,m.v9)(f.Lx),k=(0,l.T)(),E=b.find((function(e){return e.messageId===n})),I=s===L.h,O=function(){var e=(0,t.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k((0,u.qv)(n,s)).then((function(){return Z(!1)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=(0,t.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k((0,u.vx)(n,s)).then((function(){return Z(!1)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,N.jsx)("div",{className:h()("message",{"message--isMe":v}),children:(0,N.jsxs)("div",{className:"message__content",children:[(0,N.jsxs)("div",{className:"message__content-info",children:[(0,N.jsx)("div",{className:"message__content-info-avatar",children:(0,N.jsx)("img",{src:d,alt:"User"})}),(0,N.jsx)("div",{className:h()("message__content-info-bubble",{"deleted-message":E}),tabIndex:0,onClick:function(){Z(!_)},onBlur:function(e){w||Z(!1)},children:(0,N.jsx)("p",{children:s})}),E||I?(0,N.jsx)("span",{className:"spam-restore",onClick:function(){k((0,u.KI)(n,null===E||void 0===E?void 0:E.message))},children:"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c"}):(0,N.jsxs)("div",{className:"message__content-info-options",children:[_?(0,N.jsxs)("div",{className:"deleteAndSpam",children:[!v&&(0,N.jsx)(C.Z,{onClick:function(e){A({title:"\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043a\u0430\u043a \u0441\u043f\u0430\u043c?",icon:(0,N.jsx)(o.Z,{}),okText:"\u0414\u0430",okType:"danger",cancelText:"\u041d\u0435\u0442",onOk:function(){O()},onCancel:function(){Z(!1)}})},onMouseEnter:function(){return y(!0)},onMouseLeave:function(){return y(!1)}}),(0,N.jsx)(S.Z,{onClick:function(e){A({title:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?",icon:(0,N.jsx)(o.Z,{}),okText:"\u0414\u0430",okType:"danger",cancelText:"\u041d\u0435\u0442",onOk:function(){P()},onCancel:function(){Z(!1)}})},onMouseEnter:function(){return y(!0)},onMouseLeave:function(){return y(!1)}})]}):(0,N.jsx)("div",{}),x&&!_&&(0,N.jsx)("img",{src:F,alt:""}),!x&&!_&&(0,N.jsx)("img",{src:T,alt:""})]})]}),(0,N.jsx)("div",{className:"message__content-date",children:(0,N.jsx)(c.F,{date:g,showFullDate:!1})})]})})})),P=n(56200),R=n(64247),q=n(11032),B=r.memo((function(e){var s=e.dialogs,n=e.privateMessageData,a=e.handlingMessage,t=e.userID,c=t,o=(0,m.v9)(f.qf),d=(0,m.v9)(f.S3),g=(0,r.useState)(!1),h=(0,i.Z)(g,2),v=h[0],x=h[1],j=(0,r.useState)(""),p=(0,i.Z)(j,2),_=p[0],M=p[1],D=(0,l.T)();(0,r.useEffect)((function(){return D((0,u.R$)()),D(Z.E4.setRedirectToDialogPage(!1)),function(){D(Z.E4.clearDialogList()),D(Z.E4.setDialogID(null)),D(Z.E4.setRedirectToDialogPage(!1))}}),[]),(0,r.useEffect)((function(){c&&D((0,u.ti)(c,o,d))}),[n]);return(0,N.jsx)("section",{className:"home",children:(0,N.jsxs)("div",{className:"chat",children:[(0,N.jsxs)("div",{className:"chat__sidebar",children:[(0,N.jsxs)("div",{className:"chat__sidebar-header",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)(P.Z,{}),(0,N.jsx)("span",{children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432"})]}),(0,N.jsx)("div",{})]}),(0,N.jsx)("div",{className:"chat__sidebar-search",children:(0,N.jsx)(q.tg,{handleSetFilter:function(e){M(e.target.value)}})}),(0,N.jsx)("div",{className:"chat__sidebar-list",children:(0,N.jsx)(b,{selectedId:c,dialogs:s,filter:_})})]}),(0,N.jsxs)("div",{className:"chat__dialog",children:[(0,N.jsx)("div",{className:"chat__dialog-header",children:(0,N.jsx)(w,{dialogs:s,id:c})}),(0,N.jsxs)("div",{className:"chat__dialog-messages",children:[t&&(0,N.jsx)(I,{dialogs:s,id:c,setMessageSending:x,isMessageSending:v}),!t&&(0,N.jsx)(y.Z,{className:"chat__dialog-messages-empty",description:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433"})]}),(0,N.jsx)("div",{className:"chat__dialog-input",children:t&&(0,N.jsx)(R.W,{sendMessage:function(e){x(!0),a(c,e)}})})]})]})})})),H=n(5107),U=n(87781),G=r.memo((function(e){var s=e.privateMessageData,n=e.dialogs,a=e.handlingMessage,t=e.dialogID;return(0,N.jsx)(B,{dialogs:n,privateMessageData:s,handlingMessage:a,userID:t})})),$=Z.E4.sendNewMessage,K=(0,U.qC)((0,m.$j)((function(e){return{privateMessageData:(0,f.e1)(e),dialogs:(0,f.AB)(e),isFetching:(0,f.Zq)(e),dialogID:(0,f.Es)(e)}}),{sendNewMessage:$,handlingMessage:u.sg}),H.eE)(G)},28782:function(e,s,n){n.d(s,{C:function(){return m},F:function(){return f}});var a=n(72791),t=n(45939),i=n(60736),r=n(13478),c=n(11528),o=n(22258),d=n(18324),l=n(80184),u={enGB:i.Z,eo:r.Z,ru:c.Z},m=function(e){var s=e.date,n=Date.parse(s)+108e5;return(0,l.jsxs)(a.Fragment,{children:["\u041e\u043d\u043b\u0430\u0439\u043d ",(0,t.Z)(n,{addSuffix:!0,locale:u.ru})]})},f=function(e){var s,n=e.date,t=e.showFullDate,i=void 0!==t&&t;return s=i?Date.parse(n):Date.parse(n)+108e5,(0,o.Z)(s)?(0,l.jsx)(a.Fragment,{children:(0,d.Z)(s,"\u0421\u0435\u0433\u043e\u0434\u043d\u044f \u0432 HH:mm")}):i?(0,l.jsx)(a.Fragment,{children:(0,d.Z)(s,"d.MM.yyyy \u0432 HH:mm")}):(0,l.jsx)(a.Fragment,{children:(0,d.Z)(s,"d.MM.yyyy")})}}}]);
//# sourceMappingURL=670.e288d6ae.chunk.js.map